---
import DataList from "@/components/DataList.astro";
import BTGLogo from "@/assets/img-logo.svg";
---

<div id="mc_embed_shell" class="bg-btg-5 px-8 lg:px-10.5 py-8">
  <div id="mc_embed_signup">
    <form
      action="https://gmail.us14.list-manage.com/subscribe/post?u=0196d3c76853b6f37b3060933&id=85a3088c3e&f_id=00e0b5e5f0"
      method="post"
      id="mc-embedded-subscribe-form"
      name="mc-embedded-subscribe-form"
      class="validate"
      target="_blank"
    >
      <div id="mc_embed_signup_scroll">
        <h2 class="text-[2.25rem]/9 mb-5 font-light">Regístrese aquí:</h2>

        <div class="mc-field-group">
          <label for="mce-FNAME" class="text-lg">Nombre completo </label>
          <input
            type="text"
            name="FNAME"
            class="text w-full"
            id="mce-FNAME"
            value=""
            required
          />
        </div>

        <div class="mc-field-group">
          <label for="mce-EMAIL" class="text-lg">Correo electrónico</label>
          <input
            type="email"
            name="EMAIL"
            class="required email w-full"
            id="mce-EMAIL"
            required=""
            value=""
          />
        </div>

        <div class="mc-field-group">
          <label for="mce-MMERGE6" class="text-lg">Tipo de documento </label>
          <select
            name="MMERGE6"
            class="text-lg w-full"
            id="mce-MMERGE6"
            required
          >
            <option value=""></option>
            <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
            <option value="Cédula de Extranjería">Cédula de Extranjería</option>
            <option value="NIT Persona Natural">NIT Persona Natural</option>
            <option value="NIT Persona Jurídica">NIT Persona Jurídica</option>
            <option value="Tarjeta de Identidad">Tarjeta de Identidad</option>
          </select>
        </div>

        <div class="mc-field-group">
          <label for="mce-PHONE" class="text-lg">Número de documento </label>
          <input
            type="text"
            name="PHONE"
            class="REQ_CSS w-full"
            id="mce-PHONE"
            value=""
            maxlength="10"
            required
          />
        </div>

        <div class="mc-field-group">
          <label for="mce-CELULAR" class="text-lg">Celular</label>
          <input
            type="text"
            name="CELULAR"
            class="REQ_CSS w-full"
            id="mce-CELULAR"
            value=""
            maxlength="10"
            required
          />
        </div>

        <div class="mc-field-group border-t border-b pt-5 pb-8">
          <p class="text-xl pb-2">¿Cómo se enteró de este evento?</p>
          <label for="mce-INVITO" class="mb-1 block text-lg"
            >Si alguien de BTG Pactual lo invitó, indíquenos su nombre</label
          >
          <input
            type="text"
            name="INVITO"
            class="text w-full"
            id="mce-INVITO"
            value=""
            autocomplete="off"
          />
          <DataList />
          <div class="flex flex-nowrap gap-3 items-center mt-4 text-lg">
            <input
              type="checkbox"
              name="INVI_OTRO"
              id="mce-INVI_OTRO0"
              value=""
              class="w-6 h-6 not-last:shrink-0"
            />
            <p>
              Se enteró por otro medio
            </p>
          </div>
        </div>

        <div
          id="mergeRow-gdpr"
          class="mergeRow gdpr-mergeRow content__gdprBlock mc-field-group"
        >
          <div class="content__gdpr">
            <fieldset
              class="mc_fieldset gdprRequired mc-field-group"
              name="interestgroup_field"
            >
              <label class="checkbox subfield" for="gdpr315611">
                <input
                  type="checkbox"
                  id="gdpr_315611"
                  name="gdpr[315611]"
                  class="gdpr hidden"
                  value="Y"
                  checked
                />
                <p class="text-[0.625rem]/3 col-start-2 row-start-1">
                  Con el diligenciamiento de esta información, usted autoriza
                  para que BTG Pactual realice tratamiento sobre su información
                  personal conforme a la política de protección de datos
                  personales Ley 1581 de 2012. Para mayor información, <a
                    class="text-blue-1 underline hover:no-underline"
                    href="https://www.btgpactual.com.co/proteccion-de-datos"
                    target="_blank">consulte aquí nuestra política</a
                  >.
                </p>
              </label>
            </fieldset>
          </div>
        </div>

        <div hidden="">
          <input type="hidden" name="tags" value="40241743" />
        </div>
        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display: none;">
          </div>
          <div
            class="response text-center"
            id="mce-success-response"
            style="display: none;"
          >
          </div>
        </div>
        <div aria-hidden="true" style="position: absolute; left: -5000px;">
          <input
            type="text"
            name="b_0196d3c76853b6f37b3060933_85a3088c3e"
            tabindex="-1"
            value=""
          />
        </div>
        <div class="clear mt-5">
          <input
            type="submit"
            name="subscribe"
            id="mc-embedded-subscribe"
            class="button g-recaptcha"
            value="Enviar"
            data-sitekey="6LcHLWUsAAAAAAFtNWDJvpev_YTzPPVHh3q6oAIl"
            data-callback="onSubmit"
            data-action="submit"
          />
        </div>
      </div>
    </form>
  </div>

  <dialog class="successPopup">
    <form method="dialog" class="absolute top-8 right-8">
      <button
        class="appearance-none text-2xl/0 text-white font-bold cursor-pointer"
      >
        x
      </button>
    </form>
    <BTGLogo class="w-45 h-21 mx-auto" />
    <p class="pt-10 text-4xl">¡Su registro fue exitoso!</p>
    <p class="pt-6 text-2xl">
      Al correo electrónico registrado le llegará el link de conexión al evento.
    </p>
    <p class="pt-6 text-2xl">Verifique la bandeja de correo no deseado.</p>
  </dialog>
</div>

<style is:global type="text/css">
  #mergeRow-gdpr {
    margin-top: 20px;
  }
  #mergeRow-gdpr fieldset label {
    font-weight: normal;
  }
  #mc-embedded-subscribe-form .mc_fieldset {
    border: none;
    min-height: 0px;
    padding-bottom: 0px;
  }

  .mc-field-group:not(input[type="checkbox"]) {
    margin-bottom: 30px;
  }
  select,
  ::picker(select) {
    appearance: base-select;
  }

  input:not([type="checkbox"]):not([type="submit"]),
  select {
    align-items: center;
    background-color: #ffffff;
    border: 1px solid #b3b3b3;
    border-radius: 12px;
    color: #000;
    font-size: 1.125rem;
    height: 40px;
    padding-inline: 16px;

    &::placeholder {
      font-size: 1.25rem;
    }

    &:focus {
      border-color: var(--color-btg-2);
      box-shadow: 0 0 0 3px var(--color-btg-2);
      outline: none;
    }

    &.mce_inline_error {
      border: none;
      box-shadow: 0 0 0 3px var(--color-red-600);
    }
  }

  input[type="submit"] {
    background-color: var(--color-btg-3);
    border: none;
    border-radius: 0;
    color: var(--color-blue-1);
    cursor: pointer;
    display: block;
    font-size: 2.125rem;
    font-weight: 600;
    height: 52px;
    margin: auto;
    transition: all 0.3s ease-in-out;
    width: 17.375rem;

    &:hover {
      background-color: var(--color-btg-4);
      color: #fff;
    }
  }

  #mc_embed_signup input + div.mce_inline_error,
  #mc_embed_signup .checkbox + div.mce_inline_error,
  #mc_embed_signup select + div.mce_inline_error {
    background: transparent;
    color: var(--color-red-300);
    display: none;
    font-size: 0.875rem;
    line-height: 1;

    &.active {
      display: block;
    }
  }

  .successPopup {
    background-image: radial-gradient(
      circle,
      var(--color-btg-55) 44%,
      var(--color-btg-9) 100%
    );
    background-size: cover;
    color: #fff;
    padding: 52px 60px;
    margin: auto;
    max-width: 600px;
    text-align: center;
    transition: all 0.6s ease-in-out allow-discrete;

    @supports (-webkit-appearance: none) and (stroke-color: transparent) {
      opacity: unset;
      transform: unset;
    }

    &[open] {
      opacity: 100;
    }

    @starting-style {
      &[open] {
        opacity: 0;
      }
    }

    &::backdrop {
      background-color: #000;
      opacity: 0;
      transition: all 0.6s allow-discrete;
    }

    &[open]::backdrop {
      background-color: #000;
      opacity: 0.75;
    }

    @starting-style {
      &[open]::backdrop {
        background-color: #000;
        opacity: 0;
      }
    }
  }
</style>

<script
  type="text/javascript"
  src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script>

<script is:inline>
  const input = document.getElementById("mce-INVITO");
  const radio = document.getElementById("mce-INVI_OTRO0");
  const datalistId = document.getElementById("lista-comerciales");
  const dataListContent = [...datalistId.children];
  const commercialNames = dataListContent.map((option) => option.value);

  input.addEventListener("input", () => {
    if (input.value.length > 0) {
      input.setAttribute("list", datalistId.id);
      radio.checked = false;
      radio.value = "";
    } else {
      input.removeAttribute("list");
    }
  });

  input.addEventListener("blur", () => {
    if (!commercialNames.includes(input.value) && input.value.length > 0) {
      if (input.nextElementSibling.classList.contains("mce_inline_error")) {
        input.nextElementSibling.remove();
      }
      const errorDiv = document.createElement("div");
      errorDiv.classList.add("mce_inline_error");
      errorDiv.style.display = "block";
      errorDiv.textContent = `${input.value} no es un comercial válido. Por favor, seleccione un nombre de la lista o deje el campo vacío.`;
      input.insertAdjacentElement("afterEnd", errorDiv);
      input.classList.add("mce_inline_error");
    }
  });

  radio.addEventListener("change", () => {
    if (radio.checked) {
      input.value = "";
      input.removeAttribute("list");
      input.classList.remove("mce_inline_error");
      input.nextElementSibling.style.display = "none";
      radio.value = "Invitado por otro";
    }
  });

  const form = document.getElementById("mc-embedded-subscribe-form");
  const formFields = [...form.querySelectorAll("input, select")];
  const messageField = document.getElementById("mce-success-response");
  const successPopup = document.querySelector(".successPopup");
  const successMessages = {
    message1: "¡Gracias por suscribirse!",
    message2: "Ya estás suscrito, tu perfil ha sido actualizado. ¡Gracias!",
  };

  const resetError = (field) => {
    field.classList.remove("mce_inline_error");
    const errorElement = field.nextElementSibling;
    if (errorElement && errorElement.classList.contains("mce_inline_error")) {
      errorElement.style.display = "none";
    }
  };

  formFields.forEach((field) => {
    field.addEventListener("input", () => {
      resetError(field);
      messageField.textContent = "";
    });
  });

  const observer = new MutationObserver((mutationsList) => {
    for (let mutation of mutationsList) {
      if (
        mutation.addedNodes[0]?.data === successMessages.message1 ||
        mutation.addedNodes[0]?.data === successMessages.message2
      ) {
        successPopup.showModal();
        messageField.textContent = "";
      }
    }
  });

  observer.observe(messageField, {
    characterData: true,
    childList: true,
    subtree: true,
  });
</script>

<script
  src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"
  async
  defer></script>

<script type="text/javascript">
  (function ($) {
    window.fnames = new Array();
    window.ftypes = new Array();
    fnames[1] = "FNAME";
    ftypes[1] = "text";
    fnames[0] = "EMAIL";
    ftypes[0] = "email";
    fnames[6] = "MMERGE6";
    ftypes[6] = "dropdown";
    fnames[4] = "PHONE";
    ftypes[4] = "phone";
    fnames[7] = "CELULAR";
    ftypes[7] = "phone";
    fnames[14] = "INVITO";
    ftypes[14] = "text";
    fnames[15] = "INVI_OTRO";
    ftypes[15] = "radio";
    fnames[2] = "LNAME";
    ftypes[2] = "text";
    fnames[5] = "MMERGE5";
    ftypes[5] = "text";
    fnames[8] = "MMERGE8";
    ftypes[8] = "phone";
    fnames[9] = "MMERGE9";
    ftypes[9] = "text";
    fnames[10] = "MMERGE10";
    ftypes[10] = "text";
    fnames[11] = "MMERGE11";
    ftypes[11] = "radio";
    fnames[12] = "MMERGE12";
    ftypes[12] = "dropdown";
    fnames[13] = "CARGO";
    ftypes[13] = "text";
    fnames[3] = "DIRECCION";
    ftypes[3] = "text"; /*
     * Translated default messages for the $ validation plugin.
     * Locale: ES
     */
    $.extend($.validator.messages, {
      required: "Este campo es obligatorio.",
      remote: "Por favor, rellena este campo.",
      email: "Por favor, escribe una dirección de correo válida",
      url: "Por favor, escribe una URL válida.",
      date: "Por favor, escribe una fecha válida.",
      dateISO: "Por favor, escribe una fecha (ISO) válida.",
      number: "Por favor, escribe un número entero válido.",
      digits: "Por favor, escribe sólo dígitos.",
      creditcard: "Por favor, escribe un número de tarjeta válido.",
      equalTo: "Por favor, escribe el mismo valor de nuevo.",
      accept: "Por favor, escribe un valor con una extensión aceptada.",
      maxlength: $.validator.format(
        "Por favor, no escribas más de {0} caracteres.",
      ),
      minlength: $.validator.format(
        "Por favor, no escribas menos de {0} caracteres.",
      ),
      rangelength: $.validator.format(
        "Por favor, escribe un valor entre {0} y {1} caracteres.",
      ),
      range: $.validator.format("Por favor, escribe un valor entre {0} y {1}."),
      max: $.validator.format(
        "Por favor, escribe un valor menor o igual a {0}.",
      ),
      min: $.validator.format(
        "Por favor, escribe un valor mayor o igual a {0}.",
      ),
    });
  })(jQuery);
  var $mcj = jQuery.noConflict(true);
  // SMS Phone Multi-Country Functionality
  if (!window.MC) {
    window.MC = {};
  }
  window.MC.smsPhoneData = {
    defaultCountryCode: "CO",
    programs: [],
    smsProgramDataCountryNames: [],
  };

  function getCountryUnicodeFlag(countryCode) {
    return countryCode
      .toUpperCase()
      .replace(/./g, (char) =>
        String.fromCodePoint(char.charCodeAt(0) + 127397),
      );
  }

  // HTML sanitization function to prevent XSS
  function sanitizeHtml(str) {
    if (typeof str !== "string") return "";
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#x27;")
      .replace(/\//g, "&#x2F;");
  }

  // URL sanitization function to prevent javascript: and data: URLs
  function sanitizeUrl(url) {
    if (typeof url !== "string") return "";
    const trimmedUrl = url.trim().toLowerCase();
    if (
      trimmedUrl.startsWith("javascript:") ||
      trimmedUrl.startsWith("data:") ||
      trimmedUrl.startsWith("vbscript:")
    ) {
      return "#";
    }
    return url;
  }

  const getBrowserLanguage = () => {
    if (!window?.navigator?.language?.split("-")[1]) {
      return window?.navigator?.language?.toUpperCase();
    }
    return window?.navigator?.language?.split("-")[1];
  };

  function getDefaultCountryProgram(defaultCountryCode, smsProgramData) {
    if (!smsProgramData || smsProgramData.length === 0) {
      return null;
    }

    const browserLanguage = getBrowserLanguage();

    if (browserLanguage) {
      const foundProgram = smsProgramData.find(
        (program) => program?.countryCode === browserLanguage,
      );
      if (foundProgram) {
        return foundProgram;
      }
    }

    if (defaultCountryCode) {
      const foundProgram = smsProgramData.find(
        (program) => program?.countryCode === defaultCountryCode,
      );
      if (foundProgram) {
        return foundProgram;
      }
    }

    return smsProgramData[0];
  }

  function updateSmsLegalText(countryCode, fieldName) {
    if (!countryCode || !fieldName) {
      return;
    }

    const programs = window?.MC?.smsPhoneData?.programs;
    if (!programs || !Array.isArray(programs)) {
      return;
    }

    const program = programs.find(
      (program) => program?.countryCode === countryCode,
    );
    if (!program || !program.requiredTemplate) {
      return;
    }

    const legalTextElement = document.querySelector("#legal-text-" + fieldName);
    if (!legalTextElement) {
      return;
    }

    // Remove HTML tags and clean up the text
    const divRegex = new RegExp("</?[div][^>]*>", "gi");
    const fullAnchorRegex = new RegExp("<a.*?</a>", "g");
    const anchorRegex = new RegExp('<a href="(.*?)" target="(.*?)">(.*?)</a>');

    const template = program.requiredTemplate.replace(divRegex, "");

    legalTextElement.textContent = "";
    const parts = template.split(/(<a href=".*?" target=".*?">.*?<\/a>)/g);
    parts.forEach(function (part) {
      if (!part) {
        return;
      }
      const anchorMatch = part.match(
        /<a href="(.*?)" target="(.*?)">(.*?)<\/a>/,
      );
      if (anchorMatch) {
        const linkElement = document.createElement("a");
        linkElement.href = sanitizeUrl(anchorMatch[1]);
        linkElement.target = sanitizeHtml(anchorMatch[2]);
        linkElement.textContent = sanitizeHtml(anchorMatch[3]);
        legalTextElement.appendChild(linkElement);
      } else {
        legalTextElement.appendChild(document.createTextNode(part));
      }
    });
  }

  function generateDropdownOptions(smsProgramData) {
    if (!smsProgramData || smsProgramData.length === 0) {
      return "";
    }

    return smsProgramData
      .map((program) => {
        const flag = getCountryUnicodeFlag(program.countryCode);
        const countryName = getCountryName(program.countryCode);
        const callingCode = program.countryCallingCode || "";
        // Sanitize all values to prevent XSS
        const sanitizedCountryCode = sanitizeHtml(program.countryCode || "");
        const sanitizedCountryName = sanitizeHtml(countryName || "");
        const sanitizedCallingCode = sanitizeHtml(callingCode || "");
        return (
          '<option value="' +
          sanitizedCountryCode +
          '">' +
          sanitizedCountryName +
          " " +
          sanitizedCallingCode +
          "</option>"
        );
      })
      .join("");
  }

  function getCountryName(countryCode) {
    if (
      window.MC?.smsPhoneData?.smsProgramDataCountryNames &&
      Array.isArray(window.MC.smsPhoneData.smsProgramDataCountryNames)
    ) {
      for (
        let i = 0;
        i < window.MC.smsPhoneData.smsProgramDataCountryNames.length;
        i++
      ) {
        if (
          window.MC.smsPhoneData.smsProgramDataCountryNames[i].code ===
          countryCode
        ) {
          return window.MC.smsPhoneData.smsProgramDataCountryNames[i].name;
        }
      }
    }
    return countryCode;
  }

  function getDefaultPlaceholder(countryCode) {
    if (!countryCode || typeof countryCode !== "string") {
      return "+1 000 000 0000"; // Default US placeholder
    }

    var mockPlaceholders = [
      {
        countryCode: "US",
        placeholder: "+1 000 000 0000",
        helpText: "Include the US country code +1 before the phone number",
      },
      {
        countryCode: "GB",
        placeholder: "+44 0000 000000",
        helpText: "Include the GB country code +44 before the phone number",
      },
      {
        countryCode: "CA",
        placeholder: "+1 000 000 0000",
        helpText: "Include the CA country code +1 before the phone number",
      },
      {
        countryCode: "AU",
        placeholder: "+61 000 000 000",
        helpText: "Include the AU country code +61 before the phone number",
      },
      {
        countryCode: "DE",
        placeholder: "+49 000 0000000",
        helpText:
          "Fügen Sie vor der Telefonnummer die DE-Ländervorwahl +49 ein",
      },
      {
        countryCode: "FR",
        placeholder: "+33 0 00 00 00 00",
        helpText: "Incluez le code pays FR +33 avant le numéro de téléphone",
      },
      {
        countryCode: "ES",
        placeholder: "+34 000 000 000",
        helpText:
          "Incluya el código de país ES +34 antes del número de teléfono",
      },
      {
        countryCode: "NL",
        placeholder: "+31 0 00000000",
        helpText: "Voeg de NL-landcode +31 toe vóór het telefoonnummer",
      },
      {
        countryCode: "BE",
        placeholder: "+32 000 00 00 00",
        helpText: "Incluez le code pays BE +32 avant le numéro de téléphone",
      },
      {
        countryCode: "CH",
        placeholder: "+41 00 000 00 00",
        helpText:
          "Fügen Sie vor der Telefonnummer die CH-Ländervorwahl +41 ein",
      },
      {
        countryCode: "AT",
        placeholder: "+43 000 000 0000",
        helpText:
          "Fügen Sie vor der Telefonnummer die AT-Ländervorwahl +43 ein",
      },
      {
        countryCode: "IE",
        placeholder: "+353 00 000 0000",
        helpText: "Include the IE country code +353 before the phone number",
      },
      {
        countryCode: "IT",
        placeholder: "+39 000 000 0000",
        helpText:
          "Includere il prefisso internazionale IT +39 prima del numero di telefono",
      },
      {
        countryCode: "NO",
        placeholder: "+47 000 00 000",
        helpText: "Inkluder NO landskode +47 før telefonnummeret",
      },
      {
        countryCode: "SE",
        placeholder: "+46 00 000 00 00",
        helpText: "Inkludera SE landskod +46 före telefonnumret",
      },
      {
        countryCode: "DK",
        placeholder: "+45 00 00 00 00",
        helpText: "Inkluder DK landekode +45 før telefonnummeret",
      },
      {
        countryCode: "FI",
        placeholder: "+358 00 000 0000",
        helpText: "Sisällytä FI-maakoodi +358 ennen puhelinnumeroa",
      },
      {
        countryCode: "EE",
        placeholder: "+372 0000 0000",
        helpText: "Lisage EE riigikood +372 telefoninumbri ette",
      },
      {
        countryCode: "PL",
        placeholder: "+48 000 000 000",
        helpText: "Podaj numer kierunkowy PL +48 przed numerem telefonu",
      },
      {
        countryCode: "SK",
        placeholder: "+421 000 000 000",
        helpText: "Pred telefónne číslo uveďte kód krajiny SK +421",
      },
      {
        countryCode: "LV",
        placeholder: "+371 0000 0000",
        helpText: "Iekļaujiet LV valsts kodu +371 pirms tālruņa numura",
      },
      {
        countryCode: "LT",
        placeholder: "+370 0000 0000",
        helpText: "Įtraukite LT šalies kodą +370 prieš telefono numerį",
      },
      {
        countryCode: "GR",
        placeholder: "+30 000 000 0000",
        helpText:
          "Συμπεριλάβετε τον κωδικό χώρας GR +30 πριν από τον αριθμό τηλεφώνου",
      },
      {
        countryCode: "PT",
        placeholder: "+351 000 000 000",
        helpText: "Inclua o código de país PT +351 antes do número de telefone",
      },
      {
        countryCode: "HR",
        placeholder: "+385 00 000 0000",
        helpText:
          "Uključite HR pozivni broj države +385 prije telefonskog broja",
      },
      {
        countryCode: "SI",
        placeholder: "+386 00 000 000",
        helpText: "Vključite SI kodo države +386 pred telefonsko številko",
      },
      {
        countryCode: "IS",
        placeholder: "+354 000 0000",
        helpText: "Láttu IS landsnúmer +354 fylgja á undan símanúmerinu",
      },
      {
        countryCode: "LU",
        placeholder: "+352 000 000 000",
        helpText: "Incluez le code pays LU +352 avant le numéro de téléphone",
      },
      {
        countryCode: "MC",
        placeholder: "+377 00 00 00 00",
        helpText: "Incluez le code pays MC +377 avant le numéro de téléphone",
      },
      {
        countryCode: "AD",
        placeholder: "+376 000 000",
        helpText: "Incloeu el codi de país AD +376 abans del número de telèfon",
      },
      {
        countryCode: "JE",
        placeholder: "+44 0000 000000",
        helpText: "Include the JE country code +44 before the phone number",
      },
      {
        countryCode: "IM",
        placeholder: "+44 0000 000000",
        helpText: "Include the IM country code +44 before the phone number",
      },
      {
        countryCode: "GG",
        placeholder: "+44 0000 000000",
        helpText: "Include the GG country code +44 before the phone number",
      },
      {
        countryCode: "AL",
        placeholder: "+355 00 000 0000",
        helpText: "Përfshini kodin e vendit AL +355 para numrit të telefonit",
      },
      {
        countryCode: "SM",
        placeholder: "+378 0000 000000",
        helpText:
          "Includere il prefisso internazionale SM +378 prima del numero di telefono",
      },
      {
        countryCode: "FO",
        placeholder: "+298 000000",
        helpText: "Inkluder FO landekode +298 før telefonnummeret",
      },
      {
        countryCode: "MT",
        placeholder: "+356 0000 0000",
        helpText: "Include the MT country code +356 before the phone number",
      },
      {
        countryCode: "LI",
        placeholder: "+423 000 0000",
        helpText:
          "Fügen Sie vor der Telefonnummer die LI-Ländervorwahl +423 ein",
      },
      {
        countryCode: "GI",
        placeholder: "+350 000 00000",
        helpText: "Include the GI country code +350 before the phone number",
      },
      {
        countryCode: "MD",
        placeholder: "+373 00 000 000",
        helpText:
          "Includeți codul de țară MD +373 înaintea numărului de telefon",
      },
      {
        countryCode: "HU",
        placeholder: "+36 00 000 0000",
        helpText: "A telefonszám előtt adja meg a HU országkódot +36",
      },
      {
        countryCode: "NZ",
        placeholder: "+64 00 000 0000",
        helpText: "Include the NZ country code +64 before the phone number",
      },
      {
        countryCode: "ME",
        placeholder: "+382 00 000 000",
        helpText:
          "Uključite ME pozivni broj države +382 prije telefonskog broja",
      },
    ];

    const selectedPlaceholder = mockPlaceholders.find(function (item) {
      return item && item.countryCode === countryCode;
    });

    return selectedPlaceholder
      ? selectedPlaceholder.placeholder
      : mockPlaceholders[0].placeholder;
  }

  function updatePlaceholder(countryCode, fieldName) {
    if (!countryCode || !fieldName) {
      return;
    }

    const phoneInput = document.querySelector("#mce-" + fieldName);
    if (!phoneInput) {
      return;
    }

    const placeholder = getDefaultPlaceholder(countryCode);
    if (placeholder) {
      phoneInput.placeholder = placeholder;
    }
  }

  function updateCountryCodeInstruction(countryCode, fieldName) {
    updatePlaceholder(countryCode, fieldName);
  }

  function getDefaultHelpText(countryCode) {
    var mockPlaceholders = [
      {
        countryCode: "US",
        placeholder: "+1 000 000 0000",
        helpText: "Include the US country code +1 before the phone number",
      },
      {
        countryCode: "GB",
        placeholder: "+44 0000 000000",
        helpText: "Include the GB country code +44 before the phone number",
      },
      {
        countryCode: "CA",
        placeholder: "+1 000 000 0000",
        helpText: "Include the CA country code +1 before the phone number",
      },
      {
        countryCode: "AU",
        placeholder: "+61 000 000 000",
        helpText: "Include the AU country code +61 before the phone number",
      },
      {
        countryCode: "DE",
        placeholder: "+49 000 0000000",
        helpText:
          "Fügen Sie vor der Telefonnummer die DE-Ländervorwahl +49 ein",
      },
      {
        countryCode: "FR",
        placeholder: "+33 0 00 00 00 00",
        helpText: "Incluez le code pays FR +33 avant le numéro de téléphone",
      },
      {
        countryCode: "ES",
        placeholder: "+34 000 000 000",
        helpText:
          "Incluya el código de país ES +34 antes del número de teléfono",
      },
      {
        countryCode: "NL",
        placeholder: "+31 0 00000000",
        helpText: "Voeg de NL-landcode +31 toe vóór het telefoonnummer",
      },
      {
        countryCode: "BE",
        placeholder: "+32 000 00 00 00",
        helpText: "Incluez le code pays BE +32 avant le numéro de téléphone",
      },
      {
        countryCode: "CH",
        placeholder: "+41 00 000 00 00",
        helpText:
          "Fügen Sie vor der Telefonnummer die CH-Ländervorwahl +41 ein",
      },
      {
        countryCode: "AT",
        placeholder: "+43 000 000 0000",
        helpText:
          "Fügen Sie vor der Telefonnummer die AT-Ländervorwahl +43 ein",
      },
      {
        countryCode: "IE",
        placeholder: "+353 00 000 0000",
        helpText: "Include the IE country code +353 before the phone number",
      },
      {
        countryCode: "IT",
        placeholder: "+39 000 000 0000",
        helpText:
          "Includere il prefisso internazionale IT +39 prima del numero di telefono",
      },
      {
        countryCode: "NO",
        placeholder: "+47 000 00 000",
        helpText: "Inkluder NO landskode +47 før telefonnummeret",
      },
      {
        countryCode: "SE",
        placeholder: "+46 00 000 00 00",
        helpText: "Inkludera SE landskod +46 före telefonnumret",
      },
      {
        countryCode: "DK",
        placeholder: "+45 00 00 00 00",
        helpText: "Inkluder DK landekode +45 før telefonnummeret",
      },
      {
        countryCode: "FI",
        placeholder: "+358 00 000 0000",
        helpText: "Sisällytä FI-maakoodi +358 ennen puhelinnumeroa",
      },
      {
        countryCode: "EE",
        placeholder: "+372 0000 0000",
        helpText: "Lisage EE riigikood +372 telefoninumbri ette",
      },
      {
        countryCode: "PL",
        placeholder: "+48 000 000 000",
        helpText: "Podaj numer kierunkowy PL +48 przed numerem telefonu",
      },
      {
        countryCode: "SK",
        placeholder: "+421 000 000 000",
        helpText: "Pred telefónne číslo uveďte kód krajiny SK +421",
      },
      {
        countryCode: "LV",
        placeholder: "+371 0000 0000",
        helpText: "Iekļaujiet LV valsts kodu +371 pirms tālruņa numura",
      },
      {
        countryCode: "LT",
        placeholder: "+370 0000 0000",
        helpText: "Įtraukite LT šalies kodą +370 prieš telefono numerį",
      },
      {
        countryCode: "GR",
        placeholder: "+30 000 000 0000",
        helpText:
          "Συμπεριλάβετε τον κωδικό χώρας GR +30 πριν από τον αριθμό τηλεφώνου",
      },
      {
        countryCode: "PT",
        placeholder: "+351 000 000 000",
        helpText: "Inclua o código de país PT +351 antes do número de telefone",
      },
      {
        countryCode: "HR",
        placeholder: "+385 00 000 0000",
        helpText:
          "Uključite HR pozivni broj države +385 prije telefonskog broja",
      },
      {
        countryCode: "SI",
        placeholder: "+386 00 000 000",
        helpText: "Vključite SI kodo države +386 pred telefonsko številko",
      },
      {
        countryCode: "IS",
        placeholder: "+354 000 0000",
        helpText: "Láttu IS landsnúmer +354 fylgja á undan símanúmerinu",
      },
      {
        countryCode: "LU",
        placeholder: "+352 000 000 000",
        helpText: "Incluez le code pays LU +352 avant le numéro de téléphone",
      },
      {
        countryCode: "MC",
        placeholder: "+377 00 00 00 00",
        helpText: "Incluez le code pays MC +377 avant le numéro de téléphone",
      },
      {
        countryCode: "AD",
        placeholder: "+376 000 000",
        helpText: "Incloeu el codi de país AD +376 abans del número de telèfon",
      },
      {
        countryCode: "JE",
        placeholder: "+44 0000 000000",
        helpText: "Include the JE country code +44 before the phone number",
      },
      {
        countryCode: "IM",
        placeholder: "+44 0000 000000",
        helpText: "Include the IM country code +44 before the phone number",
      },
      {
        countryCode: "GG",
        placeholder: "+44 0000 000000",
        helpText: "Include the GG country code +44 before the phone number",
      },
      {
        countryCode: "AL",
        placeholder: "+355 00 000 0000",
        helpText: "Përfshini kodin e vendit AL +355 para numrit të telefonit",
      },
      {
        countryCode: "SM",
        placeholder: "+378 0000 000000",
        helpText:
          "Includere il prefisso internazionale SM +378 prima del numero di telefono",
      },
      {
        countryCode: "FO",
        placeholder: "+298 000000",
        helpText: "Inkluder FO landekode +298 før telefonnummeret",
      },
      {
        countryCode: "MT",
        placeholder: "+356 0000 0000",
        helpText: "Include the MT country code +356 before the phone number",
      },
      {
        countryCode: "LI",
        placeholder: "+423 000 0000",
        helpText:
          "Fügen Sie vor der Telefonnummer die LI-Ländervorwahl +423 ein",
      },
      {
        countryCode: "GI",
        placeholder: "+350 000 00000",
        helpText: "Include the GI country code +350 before the phone number",
      },
      {
        countryCode: "MD",
        placeholder: "+373 00 000 000",
        helpText:
          "Includeți codul de țară MD +373 înaintea numărului de telefon",
      },
      {
        countryCode: "HU",
        placeholder: "+36 00 000 0000",
        helpText: "A telefonszám előtt adja meg a HU országkódot +36",
      },
      {
        countryCode: "NZ",
        placeholder: "+64 00 000 0000",
        helpText: "Include the NZ country code +64 before the phone number",
      },
      {
        countryCode: "ME",
        placeholder: "+382 00 000 000",
        helpText:
          "Uključite ME pozivni broj države +382 prije telefonskog broja",
      },
    ];

    if (!countryCode || typeof countryCode !== "string") {
      return mockPlaceholders[0].helpText;
    }

    const selectedHelpText = mockPlaceholders.find(function (item) {
      return item && item.countryCode === countryCode;
    });

    return selectedHelpText
      ? selectedHelpText.helpText
      : mockPlaceholders[0].helpText;
  }

  function setDefaultHelpText(countryCode) {
    const helpTextSpan = document.querySelector("#help-text");
    if (!helpTextSpan) {
      return;
    }
  }

  function updateHelpTextCountryCode(countryCode, fieldName) {
    if (!countryCode || !fieldName) {
      return;
    }

    setDefaultHelpText(countryCode);
  }

  function initializeSmsPhoneDropdown(fieldName) {
    if (!fieldName || typeof fieldName !== "string") {
      return;
    }

    const dropdown = document.querySelector("#country-select-" + fieldName);
    const displayFlag = document.querySelector("#flag-display-" + fieldName);

    if (!dropdown || !displayFlag) {
      return;
    }

    const smsPhoneData = window.MC?.smsPhoneData;
    if (
      smsPhoneData &&
      smsPhoneData.programs &&
      Array.isArray(smsPhoneData.programs)
    ) {
      dropdown.innerHTML = generateDropdownOptions(smsPhoneData.programs);
    }

    const defaultProgram = getDefaultCountryProgram(
      smsPhoneData?.defaultCountryCode,
      smsPhoneData?.programs,
    );
    if (defaultProgram && defaultProgram.countryCode) {
      dropdown.value = defaultProgram.countryCode;

      const flagSpan = displayFlag?.querySelector("#flag-emoji-" + fieldName);
      if (flagSpan) {
        flagSpan.textContent = getCountryUnicodeFlag(
          defaultProgram.countryCode,
        );
        flagSpan.setAttribute(
          "aria-label",
          sanitizeHtml(defaultProgram.countryCode) + " flag",
        );
      }

      updateSmsLegalText(defaultProgram.countryCode, fieldName);
      updatePlaceholder(defaultProgram.countryCode, fieldName);
      updateCountryCodeInstruction(defaultProgram.countryCode, fieldName);
    }

    var smsNotRequiredRemoveCountryCodeEnabled = true;
    var smsField = Object.values({
      FNAME: {
        name: "FNAME",
        label: "Nombre completo",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Nombre completo",
        enabled: true,
        order: 0,
        field_type: "merge",
        merge_id: 1,
      },
      EMAIL: {
        name: "EMAIL",
        label: "Correo electrónico",
        helper_text: "",
        merge_id: 0,
        type: "email",
        required: true,
        audience_field_name: "Correo electrónico",
        field_type: "merge",
        enabled: true,
        order: 1,
      },
      MMERGE6: {
        name: "MMERGE6",
        label: "Tipo de documento",
        helper_text: "",
        type: "dropdown",
        required: false,
        audience_field_name: "Tipo de documento",
        choices: [
          { value: "Cédula de Ciudadanía", label: "Cédula de Ciudadanía" },
          { value: "Cédula de Extranjería", label: "Cédula de Extranjería" },
          { value: "NIT Persona Natural", label: "NIT Persona Natural" },
          { value: "NIT Persona Jurídica", label: "NIT Persona Jurídica" },
          { value: "Tarjeta de Identidad", label: "Tarjeta de Identidad" },
        ],
        enabled: true,
        order: 2,
        field_type: "merge",
        merge_id: 6,
      },
      PHONE: {
        name: "PHONE",
        label: "Número de documento",
        helper_text: "",
        type: "phone",
        required: false,
        audience_field_name: "Número de documento",
        phoneformat: "none",
        enabled: true,
        order: 3,
        field_type: "merge",
        merge_id: 4,
      },
      CELULAR: {
        name: "CELULAR",
        label: "Celular",
        helper_text: "",
        type: "phone",
        required: false,
        audience_field_name: "Celular",
        phoneformat: "none",
        enabled: true,
        order: 4,
        field_type: "merge",
        merge_id: 7,
      },
      INVITO: {
        name: "INVITO",
        label: "Invitado por",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Invitado por",
        enabled: true,
        order: 5,
        field_type: "merge",
        merge_id: 14,
      },
      INVI_OTRO: {
        name: "INVI_OTRO",
        label: "Invitado por otro",
        helper_text: "",
        type: "radio",
        required: false,
        audience_field_name: "Invitado por otro",
        choices: [{ value: "Invitado por otro", label: "Invitado por otro" }],
        enabled: true,
        order: 6,
        field_type: "merge",
        merge_id: 15,
      },
      LNAME: {
        name: "LNAME",
        label: "Apellidos",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Apellidos",
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 2,
      },
      MMERGE5: {
        name: "MMERGE5",
        label: "Correo electrónico",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Correo electrónico",
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 5,
      },
      MMERGE8: {
        name: "MMERGE8",
        label: "Medio / Empresa",
        helper_text: "",
        type: "phone",
        required: false,
        audience_field_name: "Medio / Empresa",
        phoneformat: "none",
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 8,
      },
      MMERGE9: {
        name: "MMERGE9",
        label: "Aceptación",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Aceptación",
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 9,
      },
      MMERGE10: {
        name: "MMERGE10",
        label: "Tipo de documento",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Tipo de documento",
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 10,
      },
      MMERGE11: {
        name: "MMERGE11",
        label: "Tipo de documento 1",
        helper_text: "",
        type: "radio",
        required: false,
        audience_field_name: "Tipo de documento 1",
        choices: [
          { value: "Cédula", label: "Cédula" },
          { value: "Pasaporte", label: "Pasaporte" },
        ],
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 11,
      },
      MMERGE12: {
        name: "MMERGE12",
        label: "Tipo de documento 2",
        helper_text: "",
        type: "dropdown",
        required: false,
        audience_field_name: "Tipo de documento 2",
        choices: [
          { value: "Cédula", label: "Cédula" },
          { value: "Pasaporte", label: "Pasaporte" },
        ],
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 12,
      },
      CARGO: {
        name: "CARGO",
        label: "Cargo",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Cargo",
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 13,
      },
      DIRECCION: {
        name: "DIRECCION",
        label: "Dirección",
        helper_text: "",
        type: "text",
        required: false,
        audience_field_name: "Dirección",
        enabled: false,
        order: null,
        field_type: "merge",
        merge_id: 3,
      },
    }).find(function (f) {
      return f.name === fieldName && f.type === "smsphone";
    });
    var isRequired = smsField ? smsField.required : false;
    var shouldAppendCountryCode = smsNotRequiredRemoveCountryCodeEnabled
      ? isRequired
      : true;

    var phoneInput = document.querySelector("#mce-" + fieldName);
    if (
      phoneInput &&
      defaultProgram.countryCallingCode &&
      shouldAppendCountryCode
    ) {
      phoneInput.value = defaultProgram.countryCallingCode;
    }

    displayFlag?.addEventListener("click", function (e) {
      dropdown.focus();
    });

    dropdown?.addEventListener("change", function () {
      const selectedCountry = this.value;

      if (!selectedCountry || typeof selectedCountry !== "string") {
        return;
      }

      const flagSpan = displayFlag?.querySelector("#flag-emoji-" + fieldName);
      if (flagSpan) {
        flagSpan.textContent = getCountryUnicodeFlag(selectedCountry);
        flagSpan.setAttribute(
          "aria-label",
          sanitizeHtml(selectedCountry) + " flag",
        );
      }

      const selectedProgram = window.MC?.smsPhoneData?.programs.find(
        function (program) {
          return program && program.countryCode === selectedCountry;
        },
      );

      var smsNotRequiredRemoveCountryCodeEnabled = true;
      var smsField = Object.values({
        FNAME: {
          name: "FNAME",
          label: "Nombre completo",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Nombre completo",
          enabled: true,
          order: 0,
          field_type: "merge",
          merge_id: 1,
        },
        EMAIL: {
          name: "EMAIL",
          label: "Correo electrónico",
          helper_text: "",
          merge_id: 0,
          type: "email",
          required: true,
          audience_field_name: "Correo electrónico",
          field_type: "merge",
          enabled: true,
          order: 1,
        },
        MMERGE6: {
          name: "MMERGE6",
          label: "Tipo de documento",
          helper_text: "",
          type: "dropdown",
          required: false,
          audience_field_name: "Tipo de documento",
          choices: [
            { value: "Cédula de Ciudadanía", label: "Cédula de Ciudadanía" },
            { value: "Cédula de Extranjería", label: "Cédula de Extranjería" },
            { value: "NIT Persona Natural", label: "NIT Persona Natural" },
            { value: "NIT Persona Jurídica", label: "NIT Persona Jurídica" },
            { value: "Tarjeta de Identidad", label: "Tarjeta de Identidad" },
          ],
          enabled: true,
          order: 2,
          field_type: "merge",
          merge_id: 6,
        },
        PHONE: {
          name: "PHONE",
          label: "Número de documento",
          helper_text: "",
          type: "phone",
          required: false,
          audience_field_name: "Número de documento",
          phoneformat: "none",
          enabled: true,
          order: 3,
          field_type: "merge",
          merge_id: 4,
        },
        CELULAR: {
          name: "CELULAR",
          label: "Celular",
          helper_text: "",
          type: "phone",
          required: false,
          audience_field_name: "Celular",
          phoneformat: "none",
          enabled: true,
          order: 4,
          field_type: "merge",
          merge_id: 7,
        },
        INVITO: {
          name: "INVITO",
          label: "Invitado por",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Invitado por",
          enabled: true,
          order: 5,
          field_type: "merge",
          merge_id: 14,
        },
        INVI_OTRO: {
          name: "INVI_OTRO",
          label: "Invitado por otro",
          helper_text: "",
          type: "radio",
          required: false,
          audience_field_name: "Invitado por otro",
          choices: [{ value: "Invitado por otro", label: "Invitado por otro" }],
          enabled: true,
          order: 6,
          field_type: "merge",
          merge_id: 15,
        },
        LNAME: {
          name: "LNAME",
          label: "Apellidos",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Apellidos",
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 2,
        },
        MMERGE5: {
          name: "MMERGE5",
          label: "Correo electrónico",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Correo electrónico",
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 5,
        },
        MMERGE8: {
          name: "MMERGE8",
          label: "Medio / Empresa",
          helper_text: "",
          type: "phone",
          required: false,
          audience_field_name: "Medio / Empresa",
          phoneformat: "none",
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 8,
        },
        MMERGE9: {
          name: "MMERGE9",
          label: "Aceptación",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Aceptación",
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 9,
        },
        MMERGE10: {
          name: "MMERGE10",
          label: "Tipo de documento",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Tipo de documento",
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 10,
        },
        MMERGE11: {
          name: "MMERGE11",
          label: "Tipo de documento 1",
          helper_text: "",
          type: "radio",
          required: false,
          audience_field_name: "Tipo de documento 1",
          choices: [
            { value: "Cédula", label: "Cédula" },
            { value: "Pasaporte", label: "Pasaporte" },
          ],
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 11,
        },
        MMERGE12: {
          name: "MMERGE12",
          label: "Tipo de documento 2",
          helper_text: "",
          type: "dropdown",
          required: false,
          audience_field_name: "Tipo de documento 2",
          choices: [
            { value: "Cédula", label: "Cédula" },
            { value: "Pasaporte", label: "Pasaporte" },
          ],
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 12,
        },
        CARGO: {
          name: "CARGO",
          label: "Cargo",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Cargo",
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 13,
        },
        DIRECCION: {
          name: "DIRECCION",
          label: "Dirección",
          helper_text: "",
          type: "text",
          required: false,
          audience_field_name: "Dirección",
          enabled: false,
          order: null,
          field_type: "merge",
          merge_id: 3,
        },
      }).find(function (f) {
        return f.name === fieldName && f.type === "smsphone";
      });
      var isRequired = smsField ? smsField.required : false;
      var shouldAppendCountryCode = smsNotRequiredRemoveCountryCodeEnabled
        ? isRequired
        : true;

      var phoneInput = document.querySelector("#mce-" + fieldName);
      if (
        phoneInput &&
        selectedProgram.countryCallingCode &&
        shouldAppendCountryCode
      ) {
        phoneInput.value = selectedProgram.countryCallingCode;
      }

      updateSmsLegalText(selectedCountry, fieldName);
      updatePlaceholder(selectedCountry, fieldName);
      updateCountryCodeInstruction(selectedCountry, fieldName);
    });
  }

  document.addEventListener("DOMContentLoaded", function () {
    const smsPhoneFields = document.querySelectorAll('[id^="country-select-"]');

    smsPhoneFields.forEach(function (dropdown) {
      const fieldName = dropdown?.id.replace("country-select-", "");
      initializeSmsPhoneDropdown(fieldName);
    });
  });
</script>
